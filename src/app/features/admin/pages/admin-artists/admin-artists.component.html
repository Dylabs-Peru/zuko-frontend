<div class="admin-section-container">
    <div class="section-header">
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
        Volver
      </button>
      <h1 class="section-title">Gesti√≥n de Artistas</h1>
      <p class="section-subtitle">Administra artistas y gestiona permisos</p>
    </div>
  
    <div class="section-content">
      <!-- Actions Bar -->
      <div class="actions-bar">
        <button 
          class="create-btn" 
          (click)="openCreateForm()"
          [disabled]="loading"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Crear Nuevo Artista
        </button>
      </div>
  
      <!-- Users List -->
      <div class="users-container">
        <div class="loading-container" *ngIf="loading && artists.length === 0">
          <div class="spinner"></div>
          <p>Cargando artistas...</p>
        </div>
  
        <div class="empty-state" *ngIf="!loading && artists.length === 0">
          <div class="empty-icon">üßë‚Äçüé§</div>
          <h3>No hay artistas registrados</h3>
          <p>Crea el primer artista del sistema</p>
          <button class="create-btn" (click)="openCreateForm()">Crear Primer Artista</button>
        </div>
  
        <div class="users-grid" *ngIf="artists.length > 0">
          <div class="user-card" *ngFor="let artist of artists">
            <div class="user-header">
              <div class="user-avatar">
                <img 
                  [src]="getProfileImageUrl(artist.user?.url_image || artist.urlImage)" 
                  [alt]="artist.name"
                  (error)="onImageError($event)"
                  loading="lazy"
                />
              </div>
              <div class="user-info">
                <h3 class="user-name">{{ artist.name }}</h3>
                <p class="user-email">{{ artist.user?.email }}</p>
              </div>
              <div class="user-status">
                <span 
                  class="status-badge"
                  [class.active]="artist.isActive"
                  [class.inactive]="!artist.isActive"
                >
                  {{ artist.isActive ? 'Activo' : 'Inactivo' }}
                </span>
              </div>
            </div>
            
            <div class="user-description" *ngIf="artist.biography">
              <p>{{ artist.biography }}</p>
            </div>
            
            <div class="user-actions">
              <button 
                class="edit-btn" 
                (click)="openEditForm(artist)"
                [disabled]="loading"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m18 2 4 4-14 14H4v-4z"></path>
                  <path d="m14.5 5.5 4 4"></path>
                </svg>
                Editar
              </button>
              
              <button 
                class="toggle-btn"
                [class.activate]="!artist.isActive"
                [class.deactivate]="artist.isActive"
                (click)="toggleArtistStatus(artist)"
                [disabled]="loading"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                </svg>
                {{ artist.isActive ? 'Desactivar' : 'Activar' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Create User Modal -->
    <div class="modal-overlay" *ngIf="showCreateForm" (click)="closeCreateForm()">
      <div class="modal-card" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Crear Nuevo Artista</h3>
          <button class="close-btn" (click)="closeCreateForm()">√ó</button>
        </div>
        
        <form [formGroup]="createArtistForm" (ngSubmit)="onCreateArtist()">
          <div class="form-row">
            <div class="form-group">
              <label for="createUsername">Nombre de Artista</label>
              <input 
                id="createUsername" 
                formControlName="name" 
                type="text" 
                placeholder="Nombre de artista √∫nico"
              />
              <div class="error-message" *ngIf="createArtistForm.get('username')?.invalid && createArtistForm.get('username')?.touched">
                {{ getCreateFieldError('username') }}
              </div>
            </div>
  
            
          </div>
  
          
  
          <div class="form-group">
  <label for="createCountry">Pa√≠s</label>
  <select id="createCountry" formControlName="country">
  <option value="" disabled selected>Selecciona un pa√≠s</option>
  <option value="Alemania">Alemania</option>
  <option value="Argentina">Argentina</option>
  <option value="Australia">Australia</option>
  <option value="Bolivia">Bolivia</option>
  <option value="Brasil">Brasil</option>
  <option value="Canad√°">Canad√°</option>
  <option value="Chile">Chile</option>
  <option value="China">China</option>
  <option value="Colombia">Colombia</option>
  <option value="Corea del Sur">Corea del Sur</option>
  <option value="Costa Rica">Costa Rica</option>
  <option value="Cuba">Cuba</option>
  <option value="Dinamarca">Dinamarca</option>
  <option value="Ecuador">Ecuador</option>
  <option value="Egipto">Egipto</option>
  <option value="El Salvador">El Salvador</option>
  <option value="Espa√±a">Espa√±a</option>
  <option value="Estados Unidos">Estados Unidos</option>
  <option value="Filipinas">Filipinas</option>
  <option value="Finlandia">Finlandia</option>
  <option value="Francia">Francia</option>
  <option value="Guatemala">Guatemala</option>
  <option value="Honduras">Honduras</option>
  <option value="India">India</option>
  <option value="Inglaterra">Inglaterra</option>
  <option value="Italia">Italia</option>
  <option value="Jap√≥n">Jap√≥n</option>
  <option value="M√©xico">M√©xico</option>
  <option value="Nicaragua">Nicaragua</option>
  <option value="Noruega">Noruega</option>
  <option value="Nueva Zelanda">Nueva Zelanda</option>
  <option value="Pa√≠ses Bajos">Pa√≠ses Bajos</option>
  <option value="Panam√°">Panam√°</option>
  <option value="Paraguay">Paraguay</option>
  <option value="Per√∫">Per√∫</option>
  <option value="Polonia">Polonia</option>
  <option value="Portugal">Portugal</option>
  <option value="Puerto Rico">Puerto Rico</option>
  <option value="Rep√∫blica Dominicana">Rep√∫blica Dominicana</option>
  <option value="Rusia">Rusia</option>
  <option value="Sud√°frica">Sud√°frica</option>
  <option value="Suecia">Suecia</option>
  <option value="Suiza">Suiza</option>
  <option value="Uruguay">Uruguay</option>
  <option value="Venezuela">Venezuela</option>
</select>
</div>

<div class="form-group">
  <label for="createBiography">Biograf√≠a (Opcional)</label>
  <textarea 
    id="createBiography" 
    formControlName="biography" 
    placeholder="Biograf√≠a del artista"
    rows="3"
  ></textarea>
</div>

<div class="form-group">
  <label class="checkbox-label">
    <input type="checkbox" formControlName="isActive" />
    <span class="checkmark"></span>
    Artista Activo
  </label>
</div>

          <div class="form-group">
            <label>Foto de Perfil</label>
            <div class="image-upload-section">
              <div class="image-preview" (click)="createFileInput.click()">
                <img 
                  *ngIf="createImagePreview" 
                  [src]="createImagePreview" 
                  alt="Preview"
                  class="preview-image"
                />
                <div *ngIf="!createImagePreview" class="upload-placeholder">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21,15 16,10 5,21"></polyline>
                  </svg>
                  <p>Seleccionar imagen</p>
                </div>
                <input 
                  #createFileInput 
                  type="file" 
                  accept="image/*" 
                  style="display: none"
                  (change)="onCreateImageSelected($event)"
                />
                <div *ngIf="uploadingImage" class="upload-overlay">
                  <div class="spinner"></div>
                  <p>Subiendo...</p>
                </div>
              </div>
              <div class="image-upload-actions">
                <button 
                  type="button" 
                  class="upload-btn" 
                  (click)="createFileInput.click()"
                  [disabled]="uploadingImage"
                >
                  {{ createImagePreview ? 'Cambiar imagen' : 'Seleccionar imagen' }}
                </button>
                <small class="upload-hint">
                  Formatos soportados: JPG, PNG, GIF (m√°x. 10MB)
                </small>
              </div>
            </div>
          </div>
  
          <!-- Error message -->
          <div class="error-message general-error" *ngIf="createArtistError">
            {{ createArtistError }}
          </div>
  
          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="closeCreateForm()">Cancelar</button>
            <button 
              type="submit" 
              class="submit-btn"
              [disabled]="createArtistForm.invalid || loading"
            >
              {{ loading ? 'Creando...' : 'Crear Artista' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  
    <!-- Edit Artist Modal -->
    <div class="modal-overlay" *ngIf="showEditForm" (click)="closeEditForm()">
      <div class="modal-card" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Editar Artista: {{ editingArtist?.name }}</h3>
          <button class="close-btn" (click)="closeEditForm()">√ó</button>
        </div>
        
        <form [formGroup]="editArtistForm" (ngSubmit)="onEditArtist()">
          <div class="form-row">
            <div class="form-group">
              <label for="editName">Nombre del Artista</label>
              <input 
                id="editName" 
                formControlName="name" 
                type="text" 
                placeholder="Nombre del artista"
              />
              <div class="error-message" *ngIf="editArtistForm.get('name')?.invalid && editArtistForm.get('name')?.touched">
                El nombre del artista es requerido (m√≠nimo 3 caracteres)
              </div>
            </div>
          </div>
  
          <div class="form-group">
            <label for="editCountry">Pa√≠s</label>
            <select id="editCountry" formControlName="country">
              <option value="" disabled selected>Selecciona un pa√≠s</option>
              <option value="Alemania">Alemania</option>
              <option value="Argentina">Argentina</option>
              <option value="Australia">Australia</option>
              <option value="Bolivia">Bolivia</option>
              <option value="Brasil">Brasil</option>
              <option value="Canad√°">Canad√°</option>
              <option value="Chile">Chile</option>
              <option value="China">China</option>
              <option value="Colombia">Colombia</option>
              <option value="Corea del Sur">Corea del Sur</option>
              <option value="Costa Rica">Costa Rica</option>
              <option value="Cuba">Cuba</option>
              <option value="Dinamarca">Dinamarca</option>
              <option value="Ecuador">Ecuador</option>
              <option value="Egipto">Egipto</option>
              <option value="El Salvador">El Salvador</option>
              <option value="Espa√±a">Espa√±a</option>
              <option value="Estados Unidos">Estados Unidos</option>
              <option value="Filipinas">Filipinas</option>
              <option value="Finlandia">Finlandia</option>
              <option value="Francia">Francia</option>
              <option value="Guatemala">Guatemala</option>
              <option value="Honduras">Honduras</option>
              <option value="India">India</option>
              <option value="Inglaterra">Inglaterra</option>
              <option value="Italia">Italia</option>
              <option value="Jap√≥n">Jap√≥n</option>
              <option value="M√©xico">M√©xico</option>
              <option value="Nicaragua">Nicaragua</option>
              <option value="Noruega">Noruega</option>
              <option value="Nueva Zelanda">Nueva Zelanda</option>
              <option value="Pa√≠ses Bajos">Pa√≠ses Bajos</option>
              <option value="Panam√°">Panam√°</option>
              <option value="Paraguay">Paraguay</option>
              <option value="Per√∫">Per√∫</option>
              <option value="Polonia">Polonia</option>
              <option value="Portugal">Portugal</option>
              <option value="Puerto Rico">Puerto Rico</option>
              <option value="Rep√∫blica Dominicana">Rep√∫blica Dominicana</option>
              <option value="Rusia">Rusia</option>
              <option value="Sud√°frica">Sud√°frica</option>
              <option value="Suecia">Suecia</option>
              <option value="Suiza">Suiza</option>
              <option value="Uruguay">Uruguay</option>
              <option value="Venezuela">Venezuela</option>
            </select>
          </div>
  
          
          <div class="form-group">
            <label for="editBiography">Biograf√≠a (Opcional)</label>
            <textarea 
              id="editBiography" 
              formControlName="biography" 
              placeholder="Biograf√≠a del artista"
              rows="3"
            ></textarea>
          </div>
  
          <div class="form-group">
            <label>Foto de Perfil</label>
            <div class="image-upload-section">
              <div class="image-preview" (click)="editFileInput.click()">
                <img 
                  *ngIf="editImagePreview" 
                  [src]="editImagePreview" 
                  alt="Preview"
                  class="preview-image"
                />
                <div *ngIf="!editImagePreview" class="upload-placeholder">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21,15 16,10 5,21"></polyline>
                  </svg>
                  <p>Seleccionar imagen</p>
                </div>
                <input 
                  #editFileInput 
                  type="file" 
                  accept="image/*" 
                  style="display: none"
                  (change)="onEditImageSelected($event)"
                />
                <div *ngIf="uploadingImage" class="upload-overlay">
                  <div class="spinner"></div>
                  <p>Subiendo...</p>
                </div>
              </div>
              <div class="image-upload-actions">
                <button 
                  type="button" 
                  class="upload-btn" 
                  (click)="editFileInput.click()"
                  [disabled]="uploadingImage"
                >
                  {{ editImagePreview ? 'Cambiar imagen' : 'Seleccionar imagen' }}
                </button>
                <small class="upload-hint">
                  Formatos soportados: JPG, PNG, GIF (m√°x. 10MB)
                </small>
              </div>
            </div>
          </div>
  
          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="closeEditForm()">Cancelar</button>
            <button 
              type="submit" 
              class="submit-btn"
              [disabled]="editArtistForm.invalid || loading"
            >
              {{ loading ? 'Guardando...' : 'Guardar Cambios' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  
  </div>